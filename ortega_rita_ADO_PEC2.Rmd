---
title: "PEC2 Análisis de Datos Ómicos"
author: "Rita Ortega Vallbona"
date: '`r format(Sys.Date(),"%e de %B, %Y")`'
output: 
  pdf_document: 
    df_print: kable
    fig_caption: yes
    keep_tex: yes
    number_sections: yes
    toc: yes
    toc_depth: 3
  html_document: 
    number_sections: yes
    theme: united
    toc: yes
    toc_float: yes
lang: en # language,  en: english (default), es: español, ...
params:
  file1: targets.csv
  file2: counts.csv
  folder.data: data
  seed.extract: 555
bibliography: bibliografiaPEC2ADO.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE,
                      comment = NA, prompt = TRUE, tidy = TRUE,
                      tidy.opts=list(width.cutoff=60),
                      fig.width = 7, 
                      fig.height = 7, fig_caption = TRUE, 
                      cache=TRUE)
```

```{r libraries, include=FALSE}
if(!require(knitr)) install.packages('knitr',  repos = 'http://cran.rstudio.com')
if(!require(kableExtra)) install.packages('kableExtra',  repos = 'http://cran.rstudio.com')

if(!require(printr)) install.packages('printr', type = 'source',repos = c('http://yihui.name/xran','http://cran.rstudio.com'))
if(!require(ggplot2)) install.packages('ggplot2', repos = 'http://cran.rstudio.com')
if(!require(ggrepel)) install.packages('ggrepel', repos = 'http://cran.rstudio.com')
```

```{r Bioconductor, include=FALSE}
if(!requireNamespace("BiocManager", quietly = TRUE)) 
BiocManager::install()

#Paquetes de Bioconductor necesarios para el análisis:

BiocManager::install("limma")
BiocManager::install("GEOquery")
BiocManager::install("oligo")
BiocManager::install("pd.mogene.2.1.st")
BiocManager::install("RSQLite")
BiocManager::install("arrayQualityMetrics")
BiocManager::install("pvca")
BiocManager::install("mogene21sttranscriptcluster.db")
BiocManager::install("magrittr")
BiocManager::install("clusterProfiler")
BiocManager::install("rWikiPathways", update = FALSE)
```

#Abstract

#Objetivos

#Materiales y métodos

##Los Datos

Obtenemos los datos de targets y counts de los archivos proporcionados en el enunciado.

```{r unzip and load data, include=FALSE}
library(utils)
unzip("archivos_targets_y_counts.zip", overwrite = FALSE, exdir = params$folder.data)

all_targets <- read.csv(file = file.path(params$folder.data, params$file1))

all_counts <- read.csv2(file = file.path(params$folder.data, params$file2), header = TRUE)
```

Con este script extraemos 10 muestras de cada grupo del archivo `r params$file1` y subseteamos las columnas escogidas en el archivo `r params$file2`.
```{r extraer los datos}
#Separamos el dataframe que recoge los targets por grupos
NIT <- subset(all_targets, Group == "NIT")
SFI <- subset(all_targets, Group == "SFI")
ELI <- subset(all_targets, Group == "ELI")

#Seleccionamos 10 muestras de cada grupo y las unimos en un único #dataframe que recoge los targets con los que trabajaremos
set.seed(params$seed.extract)
NIT10 <- NIT[sample(nrow(NIT), size = 10, replace = FALSE),]
SFI10 <- SFI[sample(nrow(SFI), size = 10, replace = FALSE),]
ELI10 <- ELI[sample(nrow(ELI), size = 10, replace = FALSE),]

mytargets <- rbind(NIT10, SFI10, ELI10, deparse.level = 0)

#Extraemos los nombres de las muestras y cambiamos los guiones #por puntos para que coincidan con los nombres de las muestras en #el dataframe de counts
sample_names <- mytargets[,3]
s_names <- gsub("-", ".", sample_names)

#Subseteamos las columans escogidas del dataframe de counts
mycounts <- dplyr::select(all_counts, s_names)
```
##Preprocesado de los datos

###Filtraje

###Normalización

##Identificación de genes diferencialmente expresados

##Anotación de los resultados

##Busca de patrones de expresión y agrupación de las muestras (comparación entre las distintas comparaciones)

##Análisis de significación biológica ("*Gene Enrichment Analysis*")

#Resultados 

#Discusión

#Apéndice

#Bibliografía
